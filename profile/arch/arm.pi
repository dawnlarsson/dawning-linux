#> compiler aarch64-linux-gnu-gcc

#> kernel_image linux/arch/arm64/boot/Image
#> kernel_export dist/kernel8.img

#> arch arm64
#> make_flags ARCH=arm64 CROSS_COMPILE=aarch64-linux-gnu-
#> virt qemu-system-aarch64

#> post sh profile/post/rpi.sh

# Architecture selection
CONFIG_64BIT=y
CONFIG_ARM=y
CONFIG_ARM64=y
CONFIG_ARCH_MULTI_V7=y
CONFIG_ARCH_MULTI_V8_2=y
CONFIG_ARCH_BCM=y
CONFIG_ARCH_BCM2835=y
CONFIG_ARCH_BCMSTB=y

# ARM specific options
CONFIG_ARM64_VA_BITS_48=y
CONFIG_ARM64_PTR_AUTH=y
CONFIG_ARM64_EPAN=y
CONFIG_ARM64_BTI=y
CONFIG_ARM64_MTE=y
CONFIG_ARM64_SVE=y
CONFIG_ARM64_PMEM=y
CONFIG_ARM64_CNP=y
CONFIG_ARM64_UAO=y
CONFIG_ARM64_LSE=y
CONFIG_ARM64_VHE=y
CONFIG_ARM64_PAN=y
CONFIG_ARM64_DEBUG_PRIORITY_MASKING=y

# BCM specific options
CONFIG_BCM2835_MBOX=y
CONFIG_BCM2835_POWER=y
CONFIG_BCM2835_VCHIQ=y
CONFIG_BCM2835_WDT=y
CONFIG_BCM2835_GPIO=y
CONFIG_BCM_VC_SM=y
CONFIG_BCM_VIDEOCORE=y
CONFIG_BCM_VCIO=y

# Memory management
CONFIG_HIGHMEM=y
CONFIG_VMALLOC_SIZE=512

# Device Tree support
CONFIG_OF=y
CONFIG_OF_FLATTREE=y
CONFIG_OF_EARLY_FLATTREE=y
CONFIG_OF_ADDRESS=y
CONFIG_OF_IRQ=y
CONFIG_OF_NET=y
CONFIG_OF_MDIO=y
CONFIG_OF_RESERVED_MEM=y
CONFIG_OF_DYNAMIC=y
CONFIG_OF_OVERLAY=y

# Raspberry Pi specific features
CONFIG_RASPBERRYPI_FIRMWARE=y

# Serial ports
CONFIG_SERIAL_8250=y
CONFIG_SERIAL_8250_BCM2835AUX=y
CONFIG_SERIAL_8250_CONSOLE=y
CONFIG_SERIAL_AMBA_PL011=y
CONFIG_SERIAL_AMBA_PL011_CONSOLE=y

# GPIO support
CONFIG_GPIOLIB=y
CONFIG_GPIO_SYSFS=y
CONFIG_GPIO_BCM_VIRT=y
CONFIG_GPIO_PL061=y
CONFIG_GPIO_BCM2835=y

# Clock support
CONFIG_COMMON_CLK=y
CONFIG_COMMON_CLK_RASPBERRY=y
CONFIG_COMMON_CLK_FIXED_MMIO=y

# MMC/SD support
CONFIG_MMC=y
CONFIG_MMC_BLOCK=y
CONFIG_MMC_BCM2835=y
CONFIG_MMC_BCM2835_DMA=y
CONFIG_MMC_BCM2835_SDHOST=y
CONFIG_MMC_SDHCI=y
CONFIG_MMC_SDHCI_PLTFM=y
CONFIG_MMC_SDHCI_IPROC=y

# USB support
CONFIG_USB=y
CONFIG_USB_ANNOUNCE_NEW_DEVICES=y
CONFIG_USB_OTG=y
CONFIG_USB_MON=y
CONFIG_USB_XHCI_HCD=y
CONFIG_USB_XHCI_PLATFORM=y
CONFIG_USB_EHCI_HCD=y
CONFIG_USB_EHCI_HCD_PLATFORM=y
CONFIG_USB_OHCI_HCD=y
CONFIG_USB_OHCI_HCD_PLATFORM=y
CONFIG_USB_DWC2=y
CONFIG_USB_GADGET=y
CONFIG_USB_CONFIGFS=y
CONFIG_USB_CONFIGFS_SERIAL=y
CONFIG_USB_CONFIGFS_ACM=y
CONFIG_USB_CONFIGFS_OBEX=y
CONFIG_USB_CONFIGFS_NCM=y
CONFIG_USB_CONFIGFS_ECM=y
CONFIG_USB_CONFIGFS_ECM_SUBSET=y
CONFIG_USB_CONFIGFS_RNDIS=y
CONFIG_USB_CONFIGFS_EEM=y
CONFIG_USB_CONFIGFS_MASS_STORAGE=y
CONFIG_USB_CONFIGFS_F_FS=y

# Network support
CONFIG_ETHERNET=y
CONFIG_NETDEVICES=y
CONFIG_NET_VENDOR_BROADCOM=y
CONFIG_BCMGENET=y
CONFIG_PHY_BROADCOM=y

# Wireless support
CONFIG_WIRELESS=y
CONFIG_CFG80211=y
CONFIG_NL80211_TESTMODE=y
CONFIG_MAC80211=y
CONFIG_MAC80211_MESH=y
CONFIG_RFKILL=y
CONFIG_RFKILL_GPIO=y
CONFIG_BRCMFMAC=y
CONFIG_BRCMFMAC_PROTO_BCDC=y
CONFIG_BRCMFMAC_SDIO=y
CONFIG_BRCMFMAC_USB=y
CONFIG_BRCM_TRACING=y
CONFIG_BRCMDBG=y

# Display support
CONFIG_FB=y
CONFIG_FB_BCM2708=y
CONFIG_FB_SIMPLE=y
CONFIG_DRM=y
CONFIG_DRM_V3D=y
CONFIG_DRM_VC4=y
CONFIG_DRM_VC4_HDMI_CEC=y
CONFIG_DRM_VC4_HDMI_HDCP=y
CONFIG_DRM_VC4_HDMI_HDMI=y
CONFIG_DRM_VC4_HDMI_HDMI0_HDCP=y
CONFIG_BACKLIGHT_CLASS_DEVICE=y
CONFIG_BACKLIGHT_PWM=y

# Sound support
CONFIG_SOUND=y
CONFIG_SND=y
CONFIG_SND_SOC=y
CONFIG_SND_BCM2835_SOC_I2S=y
CONFIG_SND_SOC_HDMI_CODEC=y

# I2C support
CONFIG_I2C=y
CONFIG_I2C_BCM2835=y
CONFIG_I2C_GPIO=y
CONFIG_I2C_MUX=y
CONFIG_I2C_MUX_PINCTRL=y
CONFIG_I2C_MUX_GPIO=y

# SPI support
CONFIG_SPI=y
CONFIG_SPI_BCM2835=y
CONFIG_SPI_BCM2835AUX=y
CONFIG_SPI_SPIDEV=y
CONFIG_SPI_GPIO=y

# Camera support
CONFIG_MEDIA_SUPPORT=y
CONFIG_MEDIA_CAMERA_SUPPORT=y
CONFIG_VIDEO_V4L2=y
CONFIG_VIDEO_BCM2835=y
CONFIG_VIDEO_CODEC_BCM2835=y
CONFIG_VIDEO_ISP_BCM2835=y

# Hardware monitoring
CONFIG_HWMON=y
CONFIG_THERMAL=y
CONFIG_THERMAL_GOV_FAIR_SHARE=y
CONFIG_THERMAL_GOV_BANG_BANG=y
CONFIG_THERMAL_GOV_STEP_WISE=y
CONFIG_THERMAL_GOV_USER_SPACE=y
CONFIG_BCM2835_THERMAL=y
CONFIG_WATCHDOG=y

# Power management
CONFIG_PM_SLEEP=y
CONFIG_PM_RUNTIME=y
CONFIG_SUSPEND=y
CONFIG_PM_CLK=y
CONFIG_PM_GENERIC_DOMAINS=y
CONFIG_RASPBERRYPI_POWER=y

# CPU Frequency scaling
CONFIG_CPU_FREQ=y
CONFIG_CPU_FREQ_STAT=y
CONFIG_CPU_FREQ_DEFAULT_GOV_ONDEMAND=y
CONFIG_CPU_FREQ_GOV_PERFORMANCE=y
CONFIG_CPU_FREQ_GOV_USERSPACE=y
CONFIG_CPU_FREQ_GOV_ONDEMAND=y
CONFIG_CPU_FREQ_GOV_CONSERVATIVE=y
CONFIG_CPU_FREQ_GOV_SCHEDUTIL=y

# RTC support
CONFIG_RTC_CLASS=y
CONFIG_RTC_HCTOSYS=y
CONFIG_RTC_SYSTOHC=y
CONFIG_RTC_DRV_PCF8523=y
CONFIG_RTC_DRV_PCF85063=y
CONFIG_RTC_DRV_DS1307=y

# Boot command line and parameters
CONFIG_CMDLINE="console=ttyAMA0,115200 console=tty1 root=/dev/mmcblk0p2 rootfstype=ext4 elevator=deadline rootwait"
CONFIG_CMDLINE_FROM_BOOTLOADER=y

# Hardware-accelerated crypto
CONFIG_CRYPTO_DEV_BCM2835=y
CONFIG_CRYPTO_AES_ARM64_CE=y
CONFIG_CRYPTO_SHA1_ARM64_CE=y
CONFIG_CRYPTO_SHA2_ARM64_CE=y
CONFIG_CRYPTO_GHASH_ARM64_CE=y

# GPIO LED support
CONFIG_LEDS_GPIO=y
CONFIG_LEDS_TRIGGERS=y
CONFIG_LEDS_TRIGGER_TIMER=y
CONFIG_LEDS_TRIGGER_ONESHOT=y
CONFIG_LEDS_TRIGGER_HEARTBEAT=y
CONFIG_LEDS_TRIGGER_BACKLIGHT=y
CONFIG_LEDS_TRIGGER_CPU=y
CONFIG_LEDS_TRIGGER_GPIO=y
CONFIG_LEDS_TRIGGER_DEFAULT_ON=y
CONFIG_LEDS_TRIGGER_TRANSIENT=y
CONFIG_LEDS_TRIGGER_CAMERA=y
CONFIG_LEDS_TRIGGER_PANIC=y
CONFIG_LEDS_TRIGGER_ACTIVITY=y

# Advanced networking options
CONFIG_INET=y
CONFIG_IP_MULTICAST=y
CONFIG_IP_ADVANCED_ROUTER=y
CONFIG_IP_MULTIPLE_TABLES=y
CONFIG_IP_ROUTE_MULTIPATH=y
CONFIG_IP_PNP=y
CONFIG_IP_PNP_DHCP=y
CONFIG_IP_PNP_BOOTP=y

# Power supply and battery monitoring
CONFIG_POWER_SUPPLY=y
CONFIG_BATTERY_BQ27XXX=y
CONFIG_CHARGER_GPIO=y

# Security options
CONFIG_SECURITY=y
CONFIG_SECURITY_NETWORK=y
CONFIG_HARDENED_USERCOPY=y
CONFIG_FORTIFY_SOURCE=y
CONFIG_SECURITY_SELINUX=y
CONFIG_SECURITY_SELINUX_BOOTPARAM=y
CONFIG_SECURITY_SELINUX_DISABLE=y
CONFIG_SECURITY_SELINUX_DEVELOP=y

# Hardware random number generator
CONFIG_HW_RANDOM=y
CONFIG_HW_RANDOM_BCM2835=y